<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

   
   
    <record id="act_project_project_2_project_task_all" model="ir.actions.act_window">
      <field name="res_model">project.task</field>
      <field name="view_type">form</field>
      <field name="name">Tasks</field>
      <field name="view_mode">kanban,tree,form,calendar,graph</field>
      <field name="context">{'search_default_project_id': [active_id], 'default_project_id': active_id}</field>
    </record>
    

  
     
    <record id="edit_project" model="ir.ui.view">
      <field name="name">sprint.sprint.form</field>
      <field name="model">sprint.sprint</field>
      <field name="arch" type="xml">
        <form string="Project" version="7.0">
          <header>
            <button name="set_done" string="Sprint Done" type="object" states="open,pending" />
            <button name="set_open" string="Re-open Sprint" type="object" states="pending" class="oe_highlight" />
            <button name="set_open" string="Re-open Sprint" type="object" states="cancelled,close" />
            <button name="set_pending" string="Pending" type="object" states="open" />
            <button name="reset_project" string="Reset as Project" type="object" states="template" class="oe_highlight" />
            <button name="set_cancel" string="Cancel" type="object" states="open,pending" />
            <field name="state" widget="statusbar" statusbar_visible="open,close" statusbar_colors='{"pending":"blue"}' readonly="1" />
          </header>
         
          <sheet string="Project">
		
            <div class="oe_title">
              <label for="name_sprint" class="oe_edit_only" />
              <h1>
                <field name="name_sprint" string="Sprint Name" />
              </h1>
      
              <div name="options_active">
                <field name="use_tasks" class="oe_inline" />
                <label for="use_tasks" />
               
              </div>
            </div>
            <div class="oe_right oe_button_box" name="buttons">
              <button name="%(act_project_project_2_project_task_all)d" string="Tasks" type="action" attrs="{'invisible':[('use_tasks','=', 0)]}" />
              <button name="%(base.action_attachment)d" string="Documents" type="action" />
            </div>
            
            <group>
              <group>
               <field name="project_id" /> <field name="description" />
              </group>
              <group>
				   <field name="user_id" string="Sprint Manager" attrs="{'readonly':[('state','in',['close', 'cancelled'])]}" />
                <field name="partner_id" on_change="onchange_partner_id(partner_id)" /> 
              </group>
            </group>
            
            <notebook>
              <page string="Team" name="team">
                <field colspan="4" name="members" widget="many2many_kanban">
                  <kanban quick_create="false" create="true">
                    <field name="name" />
                    <templates>
                      <t t-name="kanban-box">
                        <div style="position: relative">
                          <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                          <div class="oe_module_vignette">
                            <div class="oe_module_desc">
                              <field name="name" />
                            </div>
                          </div>
                        </div>
                      </t>
                    </templates>
                  </kanban>
                </field>
              </page>
              <page string="Other Info">
                <group>
                  <group string="Email Interface" attrs="{'invisible': [('alias_domain', '=', False)]}">
                    <div>
                      <field name="alias_id" invisible="1" required="0" />
                      <label for="alias_name" class="oe_edit_only " />
                      <field name="alias_name" class="oe_inline" attrs="{'required': [('alias_id', '!=', False)]}" />
                      @
                      <field name="alias_domain" class="oe_inline" />
                    </div>
                  </group>
                  <group string="Administration" groups="project.group_time_work_estimation_tasks">
                    <field name="planned_hours" widget="float_time" />
                    <field name="effective_hours" widget="float_time" />
                    <field name="resource_calendar_id" />
                  </group>
                  <group string="Miscellaneous" name="misc">
                    <field name="date_start" />
                    <field name="date" string="End Date" />
                    <field name="priority" groups="base.group_no_one" />
                    <field name="active" attrs="{'invisible':[('state','in',['open', 'pending', 'template'])]}" />
                    <field name="currency_id" groups="base.group_multi_currency" required="1" />
                   
                  </group>
                </group>
              </page>
              <page string="Tasks Stages" attrs="{'invisible': [('use_tasks', '=', False)]}">
                <field name="type_ids" />
              </page>
            </notebook>
          </sheet>
          <div class="oe_chatter">
            <field name="message_ids" widget="mail_thread" />
            <field name="message_follower_ids" widget="mail_followers" help="Follow this project to automatically follow all related tasks and issues." />
          </div>
        </form>
      </field>
    </record>
    
<!--
     VIEW IN SELECT
-->
     
    <record id="view_project_project_filter" model="ir.ui.view">
      <field name="name">sprint.sprint.select</field>
      <field name="model">sprint.sprint</field>
      <field name="arch" type="xml">
        <search string="Search Project">
          <field name="complete_name" string="Project Name" />
          <filter icon="terp-mail-message-new" string="Unread Messages" name="message_unread" domain="[('message_unread','=',True)]" />
          <separator />
          <filter icon="terp-check" string="Open" name="Current" domain="[('state', '=','open')]" help="Open Projects" />
          <filter icon="gtk-media-pause" string="Pending" name="Pending" domain="[('state', '=','pending')]" help="Pending Projects" />
          <filter icon="gtk-media-pause" string="Template" name="Template" domain="[('state', '=','template')]" help="Templates of Projects" />
          <separator />
          <filter icon="terp-personal+" string="Member" domain="['|',('user_id', '=', uid),('members', '=', uid)]" help="Projects in which I am a member." />
          <separator />
          <filter string="Project(s) Manager" domain="[('user_id','=',uid)]" help="Projects in which I am a manager" icon="terp-personal" />
          <field name="user_id" string="Project Manager" />
          <field name="partner_id" string="Contact" />
          <group expand="0" string="Group By...">
            <filter string="Manager" name="Manager" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}" />
            <filter string="Contact" name="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}" />
            <filter string="Parent" name="Parent" help="Parent" icon="terp-folder-blue" domain = "[]"  context="{'group_by':'parent_id'}" />
          </group>
        </search>
      </field>
    </record>
    
<!--
VIEW IN TREE
-->
    
    <record id="view_project" model="ir.ui.view">
      <field name="name">sprint.sprint.tree</field>
      <field name="model">sprint.sprint</field>
      <field name="field_parent">child_ids</field>
      <field name="arch" type="xml">
        <tree fonts="bold:message_unread==True" colors="red:date and (date&lt;current_date) and (state == 'open');blue:state in ('draft','pending');grey: state in ('close','cancelled')" string="Projects">
          <field name="sequence" invisible="1" />
          <field name="message_unread" invisible="1" />
          <field name="date" invisible="1" />
          <field name="name" string="Project Name" />
          <field name="user_id" string="Project Manager" />
          <field name="partner_id" string="Contact" />
          <field name="parent_id" string="Parent" invisible="1" />
          <field name="planned_hours" widget="float_time" />
          <field name="total_hours" widget="float_time" />
          <field name="effective_hours" widget="float_time" />
          <field name="progress_rate" widget="progressbar" />
          <field name="state" />
        </tree>
      </field>
    </record>
    
<!--
VIEW IN KANBAN
-->
    
    <record model="ir.ui.view" id="view_project_kanban">
      <field name="name">sprint.sprint.kanban</field>
      <field name="model">sprint.sprint</field>
      <field name="arch" type="xml">
        <kanban version="7.0" class="oe_background_grey">
          <field name="effective_hours" />
          <field name="planned_hours" />
          <field name="name" />
          <field name="members" />
          <field name="use_tasks" />
          <field name="user_id" />
          <field name="date" />
          <field name="color" />
          <field name="task_count" />
          <field name="alias_id" />
          <field name="alias_domain" />
          <templates>
            <t t-name="kanban-box">
              <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_project oe_kanban_global_click">
                <div class="oe_dropdown_toggle oe_dropdown_kanban">
                  <span class="oe_e">Ã­</span>
                  <ul class="oe_dropdown_menu">
                    <t t-if="widget.view.is_action_enabled('edit')"><li><a type="edit">Edit...</a></li></t>
                    <t t-if="widget.view.is_action_enabled('delete')"><li><a type="delete">Delete</a></li></t>
                    <li><ul class="oe_kanban_colorpicker" data-field="color" /></li>
                  </ul>
                </div>
                
                <div class="oe_kanban_content">
                  <h4>
                    <field name="name" />
                  </h4>
                  <div class="oe_kanban_project_list">
                    <a t-if="record.use_tasks.raw_value" name="%(act_project_project_2_project_task_all)d" type="action">
                      <field name="task_count" />
                      Tasks
                    </a>
                  </div>
                  <div class="oe_kanban_footer_left">
                    <span groups="project.group_time_work_estimation_tasks">
                      <span class="oe_e">R</span>
						<t t-esc="Math.round(record.effective_hours.raw_value)" /> /
						<t t-esc="Math.round(record.planned_hours.raw_value)" />
						<field name="company_uom_id" />
                    </span>
                    
                    <span t-if="record.date.raw_value">
                      <span class="oe_e">N</span>
                      <field name="date" />
                    </span>
                    
				</div>
				  <div class="oe_kanban_project_avatars">
					<t t-foreach="record.members.raw_value" t-as="member">
					  <img t-att-src="kanban_image('res.users', 'image_small', member)" t-att-data-member_id="member" />
					</t>
				  </div>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>
    
<!--
VIEW IN GANTT
-->
    
    <record id="view_project_project_gantt" model="ir.ui.view">
      <field name="name">sprint.sprint.gantt</field>
      <field name="model">sprint.sprint</field>
      <field name="arch" type="xml">
        <gantt date_delay="planned_hours" date_start="date_start" string="Projects" />
      </field>
    </record>
    <record id="open_view_project_all" model="ir.actions.act_window">
      <field name="name">Projects</field>
      <field name="res_model">sprint.sprint</field>
      <field name="view_type">form</field>
      <field name="domain">[]</field>
      <field name="view_mode">kanban,tree,form,gantt</field>
      <field name="view_id" ref="view_project_kanban" />
      <field name="search_view_id" ref="view_project_project_filter" />
      <field name="context">{}</field>
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">Click to start a new project.</p>
        <p>
          Projects are used to organize your activities; plan
          tasks, track issues, invoice timesheets. You can define
          internal projects (R&amp;D, Improve Sales Process),
          private projects (My Todos) or customer ones.
        </p>
        <p>
          You will be able collaborate with internal users on
          projects or invite customers to share your activities.
        </p>
      </field>
    </record>
    <record id="open_view_template_project" model="ir.actions.act_window">
      <field name="name">Templates of Projects</field>
      <field name="res_model">sprint.sprint</field>
      <field name="view_type">form</field>
      <field name="domain">[('state','=','template')]</field>
      <field name="view_id" ref="view_project" />
    </record>
    <record id="view_task_work_form" model="ir.ui.view">
      <field name="name">project.task.work.form</field>
      <field name="model">project.task.work</field>
      <field name="arch" type="xml">
        <form string="Task Work" version="7.0">
          <group col="4">
            <field colspan="4" name="name" />
            <field name="hours" widget="float_time" />
            <field name="date" />
            <field name="user_id" options='{"no_open": True}' />
            <field name="company_id" groups="base.group_multi_company" widget="selection" />
          </group>
        </form>
      </field>
    </record>
    <record id="view_task_work_tree" model="ir.ui.view">
      <field name="name">project.task.work.tree</field>
      <field name="model">project.task.work</field>
      <field name="arch" type="xml">
        <tree editable="top" string="Task Work">
          <field name="date" />
          <field name="name" />
          <field name="hours" widget="float_time" />
          <field name="user_id" />
        </tree>
      </field>
    </record>
    <!-- Task -->
  
  


    <!-- Opening task when double clicking on project -->
    <record id="dblc_proj" model="ir.actions.act_window">
      <field name="res_model">project.task</field>
      <field name="name">Project's tasks</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form,calendar,graph,gantt,kanban</field>
      <field name="domain">[('project_id', 'child_of', [active_id])]</field>
      <field name="context">{'project_id':active_id, 'active_test':False}</field>
    </record>
    <record id="ir_project_task_open" model="ir.values">
      <field eval="'tree_but_open'" name="key2" />
      <field eval="'sprint.sprint'" name="model" />
      <field name="name">View project's tasks</field>
      <field eval="'ir.actions.act_window,'+str(dblc_proj)" name="value" />
    </record>
    
    <!-- Task types -->
    <record id="task_type_search" model="ir.ui.view">
      <field name="name">project.task.type.search</field>
      <field name="model">project.task.type</field>
      <field name="arch" type="xml">
        <search string="Tasks Stages">
          <field name="name" string="Tasks Stages" />
          <filter icon="terp-check" string="Common" name="common" domain="[('case_default', '=', 1)]" help="Stages common to all projects" />
        </search>
      </field>
    </record>
    
    <record id="task_type_edit" model="ir.ui.view">
      <field name="name">project.task.type.form</field>
      <field name="model">project.task.type</field>
      <field name="arch" type="xml">
        <form string="Task Stage" version="7.0">
          <group>
            <group>
              <field name="name" />
              <field name="case_default" />
            </group>
            <group>
              <field name="state" />
              <field name="sequence" />
              <field name="fold" />
            </group>
          </group>
          <field name="description" placeholder="Add a description..." />
        </form>
      </field>
    </record>
    <record id="task_type_tree" model="ir.ui.view">
      <field name="name">project.task.type.tree</field>
      <field name="model">project.task.type</field>
      <field name="arch" type="xml">
        <tree string="Task Stage">
          <field name="sequence" widget="handle" />
          <field name="name" />
          <field name="state" />
        </tree>
      </field>
    </record>
    
<!--
    <record id="open_task_type_form" model="ir.actions.act_window">
      <field name="name">Stages</field>
      <field name="res_model">project.task.type</field>
      <field name="view_type">form</field>
      <field name="view_id" ref="task_type_tree" />
      <field name="help" type="html">
        <p class="oe_view_nocontent_create">Click to add a stage in the task pipeline.</p>
        <p>
          Define the steps that will be used in the project from the
          creation of the task, up to the closing of the task or issue.
          You will use these stages in order to track the progress in
          solving a task or an issue.
        </p>
      </field>
    </record>
-->

    <menuitem action="open_task_type_form" name="Task Stages" id="menu_task_types_view" parent="base.menu_project_config_project" sequence="2" />
    <menuitem action="open_view_project_all" id="menu_projects" name="Sprint New" parent="project.menu_project_management" sequence="1" />
   
   
    <record id="task_company" model="ir.ui.view">
      <field name="name">res.company.task.config</field>
      <field name="model">res.company</field>
      <field name="inherit_id" ref="base.view_company_form" />
      <field name="arch" type="xml">
        <xpath expr="//group[@name='account_grp']" position="after">
          <group name="project_grp" string="Projects">
            <field name="project_time_mode_id" domain="[('category_id','=','Working Time')]" />
          </group>
        </xpath>
      </field>
    </record>
    <!-- User Form -->
    <act_window context="{'search_default_user_id': [active_id], 'default_user_id': active_id}" domain="[('state', '&lt;&gt;', 'cancelled'),('state', '&lt;&gt;', 'done')]" id="act_res_users_2_project_task_opened" name="Assigned Tasks" res_model="project.task" src_model="res.users" view_mode="tree,form,gantt,calendar,graph" view_type="form" />
  </data>
</openerp>

